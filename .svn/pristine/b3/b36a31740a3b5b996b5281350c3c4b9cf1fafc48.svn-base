package bean;



import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.TreeSet;

import javax.ejb.EJB;
import javax.enterprise.context.RequestScoped;
import javax.enterprise.inject.Model;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.ManagedProperty;
import javax.faces.bean.ViewScoped;
import javax.inject.Inject;
import javax.inject.Named;

import control.EventManager;
import control.NotificationManager;
import entity.BadWeatherCondition;
import entity.Event;
import entity.IndoorEvent;
import entity.Notification;
import entity.User;
import bean.CheckboxView;
import entity.NotificationType;

@ManagedBean
@ViewScoped
public class EventCreationBean {
    
    @EJB EventManager evMan;
    @EJB NotificationManager nm;
    @ManagedProperty("#{checkboxView}") CheckboxView cbw;
    private BadWeatherCondition badWeatherCondition;
    
    private Event current;
    
    private String indoor;
    
    
    public EventCreationBean() {
    }

    public void setCurrent(Event current) { 
        this.current = current;
    }

    public Event getCurrent() {
        if (current==null) {
            current = new Event();
        }
        return current;
    }
    
    public String createEvent() {
    	System.out.println(cbw.getSelectedUsers());
    	evMan.create(current);
    	for(User u:cbw.getSelectedUsers()) {
    		nm.createNotification(u,current,NotificationType.INVITATION);
    	}        
        return "mainPage?faces-redirect=true";
    }
    
    public String updateEvent() {
    	
    	return "mainPage";
    }
    
    
    public void setCbw(CheckboxView cbw) {
    	this.cbw=cbw;
    }
    
    public CheckboxView getCbw() {
    	return cbw;
    }
    
    public String mainPage() {
    	return "mainPage";
    }

	public String getIndoor() {
		if(getCurrent().equals("indoor"))
			indoor="true";
		else
			indoor="false";
		return indoor;
	}

	public void setIndoor(String indoor) {
		this.indoor = indoor;
	}

	public BadWeatherCondition[] getBadWeatherCondition() {
		return badWeatherCondition.values();
	}

	public void setBadWeatherCondition(BadWeatherCondition badWeatherCondition) {
		this.badWeatherCondition = badWeatherCondition;
	}
    
    
}
